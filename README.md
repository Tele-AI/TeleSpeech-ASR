<div align="center">
<h1>
  æ˜Ÿè¾°è¯­éŸ³å¤§æ¨¡å‹-è¶…å¤šæ–¹è¨€ASR
</h1>
</div>

<p align="center">
ğŸ¤— <a href="https://huggingface.co/Tele-AI/TeleSpeech-ASR1.0" target="_blank">Hugging Face</a> â€¢ ğŸ¾ <a href="https://gitee.com/Tele-AI/TeleSpeech-ASR" target="_blank">gitee</a>ï¸
</p>

# ç›®å½•
- [ç›®å½•](#ç›®å½•)
- [æ¨¡å‹å¼€æº](#æ¨¡å‹å¼€æº)
- [ç¯å¢ƒé…ç½®](#ç¯å¢ƒé…ç½®)
  - [å¾®è°ƒ](#å¾®è°ƒ)
  - [è¡¨å¾è®­ç»ƒä¸‹æ¸¸ä»»åŠ¡](#è¡¨å¾è®­ç»ƒä¸‹æ¸¸ä»»åŠ¡)
- [æ•°æ®å‡†å¤‡](#æ•°æ®å‡†å¤‡)
  - [ç‰¹å¾æå–](#ç‰¹å¾æå–)
  - [å­—å…¸å‡†å¤‡](#å­—å…¸å‡†å¤‡)
- [é¢„è®­ç»ƒæ¨¡å‹å¾®è°ƒ](#é¢„è®­ç»ƒæ¨¡å‹å¾®è°ƒ)
  - [å¾®è°ƒ](#å¾®è°ƒ-1)
  - [è§£ç ](#è§£ç )
- [è¡¨å¾è®­ç»ƒä¸‹æ¸¸ä»»åŠ¡](#è¡¨å¾è®­ç»ƒä¸‹æ¸¸ä»»åŠ¡-1)
- [å¼€æºæ•°æ®é›†ç»“æœ](#å¼€æºæ•°æ®é›†ç»“æœ)
- [å£°æ˜ä¸åè®®](#å£°æ˜ä¸åè®®)
  - [å£°æ˜](#å£°æ˜)
  - [åè®®](#åè®®)

# æ¨¡å‹å¼€æº

æ˜Ÿè¾°è¶…å¤šæ–¹è¨€è¯­éŸ³è¯†åˆ«å¤§æ¨¡å‹v1.0ï¼Œç”±30wå°æ—¶æ— æ ‡æ³¨å¤šæ–¹è¨€è¯­éŸ³æ•°æ®è¿›è¡Œè®­ç»ƒï¼Œæ‰“ç ´å•ä¸€æ¨¡å‹åªèƒ½è¯†åˆ«ç‰¹å®šå•ä¸€æ–¹è¨€çš„å›°å¢ƒï¼Œå¯æ”¯æŒç†è§£ç²¤è¯­ã€ä¸Šæµ·è¯ã€å››å·è¯ã€æ¸©å·è¯ç­‰30å¤šç§æ–¹è¨€


æœ¬æ¬¡å‘å¸ƒç‰ˆæœ¬å’Œä¸‹è½½é“¾æ¥è§ä¸‹è¡¨

| æ¨¡å‹ç‰ˆæœ¬             | å‚æ•°é‡  | ä¸‹è½½é“¾æ¥     |
|---------------------|-------|---------------------|
| pretrain_base | 0.09 B | [TeleSpeech-ASR1.0-base](https://huggingface.co/Tele-AI/TeleSpeech-ASR1.0/blob/main/base.pt)  |
| pretrain_large | 0.3 B | [TeleSpeech-ASR1.0-large](https://huggingface.co/Tele-AI/TeleSpeech-ASR1.0/blob/main/large.pt)  |


# ç¯å¢ƒé…ç½®
ç¯å¢ƒä¾èµ–
* PyTorch version >= 1.13.0
* Python version >= 3.8
* æ•°æ®å‡†å¤‡ã€ç¨‹åºè®­ç»ƒéœ€è¦ä½¿ç”¨kaldiï¼Œè¯·ç¡®ä¿å·²æ­£ç¡®å®‰è£…ï¼šhttps://github.com/kaldi-asr/kaldi
  * è‹¥å·²æœ‰æå¥½çš„ç‰¹å¾ï¼Œç¨‹åºè¿è¡Œæ—¶å¯ä»¥ä½¿ç”¨wenetå¼€æºæ¡†æ¶ä¸­kaldi_io.pyå®ç°çš„æ–¹æ³•æ›¿æ¢kaldiio.load_matï¼Œä»è€Œæ— éœ€å®‰è£…kaldi

## å¾®è°ƒ

<a id="fairseqå®‰è£…"></a>
* å®‰è£…fairseqåŠå…¶ä¾èµ–
```shell script
$ git clone https://github.com/pytorch/fairseq
$ cd fairseq
$ pip install --editable ./
```

* å®‰è£…kaldiio
```shell script
$ pip install kaldiio
```

## è¡¨å¾è®­ç»ƒä¸‹æ¸¸ä»»åŠ¡

* ç¡®ä¿fairseqå·²æ­£ç¡®[å®‰è£…](#fairseqå®‰è£…)

* å®‰è£…è¡¨å¾è®­ç»ƒä»»åŠ¡è¿è¡Œæ‰€éœ€ä¾èµ–
```shell script
$ cd wenet_representation
$ pip install -r requirements.txt
```

# æ•°æ®å‡†å¤‡
## ç‰¹å¾æå–

* åˆ©ç”¨kaldiæå–40ç»´mfccç‰¹å¾ï¼Œå‚æ•°è®¾ç½®å‚è€ƒ`mfcc_hires.conf`
* ä¸ºå„æ•°æ®é›†å‡†å¤‡è®­ç»ƒç”¨æ–‡ä»¶`data.list`ï¼Œä»¥`\t`åˆ†éš”ï¼š
```
$ cat train/data.list
utt:X0000000000_100638174_S00037	feat:/data/raw_nnaudio.test.1.ark:2983479385	feat_shape:363,40	text:ä¸æƒœåœ¨è¿™ç§è¯•éªŒä¸­æ¯ç­åŒ…æ‹¬è‡ªå·±åœ¨å†…çš„ä¸€åˆ‡	token:ä¸ æƒœ åœ¨ è¿™ ç§ è¯• éªŒ ä¸­ æ¯ ç­ åŒ… æ‹¬ è‡ª å·± åœ¨ å†… çš„ ä¸€ åˆ‡	tokenid:[TOKENID]	token_shape:19,5537
utt:X0000000001_100849618_S00006	feat:/data/raw_nnaudio.test.1.ark:2984296665	feat_shape:345,40	text:åœ¨ä»–ä»¬æ”¶åˆ°è¶³å¤Ÿå»ºç«‹å¤§ç»Ÿä¸€æ¨¡å‹çš„æ•°æ®å	token:åœ¨ ä»– ä»¬ æ”¶ åˆ° è¶³ å¤Ÿ å»º ç«‹ å¤§ ç»Ÿ ä¸€ æ¨¡ å‹ çš„ æ•° æ® å	tokenid:[TOKENID]	token_shape:18,5537
...
```

## å­—å…¸å‡†å¤‡

* å¾®è°ƒé˜¶æ®µï¼Œéœ€è¦å‡†å¤‡fairseqæ ¼å¼çš„ `dict.${label}.txt`ï¼Œ`${label}`ä¸ºå»ºæ¨¡å•å…ƒç±»å‹ï¼Œå¦‚ltr, bpeç­‰ã€‚ä»¥`dict.ltr.txt`ä¸ºä¾‹ï¼š
```
æ˜¯ 2
å¥½ 3
...
```

* é¢„è®­ç»ƒæ¨¡å‹è¡¨å¾è®­ç»ƒASRä»»åŠ¡é˜¶æ®µï¼Œéœ€è¦å‡†å¤‡wenetæ ¼å¼çš„`lang_char.txt`ï¼Œç›¸æ¯”äº`dict.${label}.txt`é¢å¤–æ·»åŠ `<blank>`, `<unk>`, `<sos/eos>`3ä¸ªtokenï¼Œä¾‹å¦‚
```
<blank> 0
<unk> 1
æ˜¯ 2
å¥½ 3
...
<sos/eos> 5536
```

# é¢„è®­ç»ƒæ¨¡å‹å¾®è°ƒ

## å¾®è°ƒ
* å‡†å¤‡`train.tsv`å’Œ`dev.tsv`ï¼Œä¿å­˜äºåŒä¸€è®­ç»ƒç›®å½•ä¸‹
    ```
    $ ln -s /path/to/train/data.list /path/to/train/train.tsv
    $ ln -s /path/to/dev/data.list /path/to/train/dev.tsv
    ```
* è¿›å…¥data2vec_dialectè·¯å¾„ï¼Œä¿®æ”¹`path.sh`æ–‡ä»¶ä¸­`/path/to/fairseq`ä¸ºfairseqå®‰è£…è·¯å¾„
* å°†`run_scripts/run_d2v_finetune.sh`ä¸­`/path/to/fairseq`å’Œ`/path/to/data2vec_dialect`è·¯å¾„æ›¿æ¢
* ä¿®æ”¹`task.data`ä¸º`.tsv`ä¿å­˜è·¯å¾„ï¼Œå¦‚`task.data=/data/wenetspeech/train`
* æ‰§è¡Œ
    ```shell script
    $ bash run_scripts/run_d2v_finetune.sh
    ```

## è§£ç 
* åŒæ ·ä¿®æ”¹`run_scripts/decode.sh`ä¸­çš„æ¨¡å‹è·¯å¾„ã€æµ‹è¯•æ•°æ®è·¯å¾„ç­‰
  * `dataset.gen_subset`ä¸ºæµ‹è¯•æ•°æ®è·¯å¾„ä¸‹`tsv`æ–‡ä»¶çš„åç§°ï¼Œå¯é…ç½®å¤šä¸ª
* æ‰§è¡Œ
    ```shell script
    $ bash run_scripts/decode.sh
    ```

# è¡¨å¾è®­ç»ƒä¸‹æ¸¸ä»»åŠ¡

* è¿›å…¥wenet_representationè·¯å¾„ï¼Œä¿®æ”¹`path.sh`æ–‡ä»¶ä¸­`fairseq`, `data2vec_dialect`, `wenet_representation`ç›¸å…³è·¯å¾„

* è¿ç»­è¡¨å¾è®­ç»ƒä¸è§£ç ï¼š
  * é…ç½®`run_d2v.sh`ä¸­datasetç›¸å…³å†…å®¹ï¼Œæ‰§è¡Œ
    ```shell script
    $ bash run_d2v.sh
    ```

* ç¦»æ•£è¡¨å¾è®­ç»ƒä¸è§£ç ï¼š
  * é¦–å…ˆæ ¹æ®`data.list`ï¼Œå‡†å¤‡ç¦»æ•£è¡¨å¾å¯¹åº”è®­ç»ƒæ–‡ä»¶`data.list.discrete`ï¼Œä¿®æ”¹`wenet/discrete_token/kmeans_d2v.yaml`ä¸­`model_dir`å’Œ`user_dir`ï¼Œæ‰§è¡Œ
    ```
    $ bash wenet/discrete_token/dump_feat.sh
    ```
  * å†é…ç½®`run_discrete.sh`ä¸­datasetç›¸å…³å†…å®¹ï¼Œæ‰§è¡Œ
    ```
    $ bash run_discrete.sh
    ```
# å¼€æºæ•°æ®é›†ç»“æœ
* æˆ‘ä»¬é€‰æ‹©äº†å¤šä¸ªå¼€æºä¸­æ–‡æ•°æ®é›†è¿›è¡ŒéªŒè¯ï¼Œä»¥æµ‹è¯•é›†ä¸Šçš„å­—é”™è¯¯ç‡ (Character Error Rate, CER) ç»“æœä½œä¸ºè¡¡é‡æ ‡å‡†
* åœ¨Aishell-1ä¸Šæˆ‘ä»¬é€‰æ‹©å…¶Trainé›†ä½œä¸ºæœ‰ç›‘ç£æ•°æ®è¿›è¡Œè®­ç»ƒï¼Œåœ¨Testé›†ä¸Šç»Ÿè®¡CER
* åœ¨WenetSpeechä¸Šï¼Œæˆ‘ä»¬åˆ†åˆ«ä½¿ç”¨100å°æ—¶è®­ç»ƒé›†Train_så’Œ1000å°æ—¶è®­ç»ƒé›†Train_måˆ†åˆ«ä½œä¸ºæœ‰ç›‘ç£æ•°æ®è¿›è¡Œè®­ç»ƒï¼Œåœ¨Test_Meetingæµ‹è¯•é›†ä¸Šç»Ÿè®¡CER
* Babelä¸ºNISTï¼ˆç¾å›½å›½å®¶æ ‡å‡†ä¸æŠ€æœ¯ç ”ç©¶é™¢ï¼‰ä¸¾åŠçš„ä½èµ„æºç²¤è¯­ç”µè¯è¯†åˆ«ä»»åŠ¡æ•°æ®é›†ï¼Œæˆ‘ä»¬ä½¿ç”¨å…¶æä¾›çš„è®­ç»ƒé›†ä¸æµ‹è¯•é›†ç»Ÿè®¡CER
* KeSpeechä¸ºä¸­æ–‡å¤šæ–¹è¨€æµ‹è¯•é›†ï¼Œæˆ‘ä»¬ä½¿ç”¨1396å°æ—¶è®­ç»ƒé›†ä½œä¸ºæœ‰ç›‘ç£æ•°æ®è¿›è¡Œè®­ç»ƒï¼Œé€‰æ‹©æä¾›çš„Testæµ‹è¯•é›†ç»Ÿè®¡CER

|  æ¨¡å‹ç‰ˆæœ¬         | Aishell-1 | WenetSpeech*| Babel | KeSpeech |
| ----------| -------- | ------- | ---- | ---- |
| pretrain_base | 4.7  | 18.3 / 16.4 | 22.1  | 10.9 |
| pretrain_large | 4.0 | 14.3 / 13.0 | 19.1  | 8.1 |

*WenetSpeechä¸­çš„ç»“æœä¸ºåˆ†åˆ«ä½¿ç”¨ `train_s/train_m`è®­ç»ƒåï¼Œåœ¨Test_Meetingä¸Šçš„CER

# å£°æ˜ä¸åè®®
## å£°æ˜
æˆ‘ä»¬åœ¨æ­¤å£°æ˜ï¼Œä¸è¦ä½¿ç”¨TeleSpeechæ¨¡å‹åŠå…¶è¡ç”Ÿæ¨¡å‹è¿›è¡Œä»»ä½•å±å®³å›½å®¶ç¤¾ä¼šå®‰å…¨æˆ–è¿æ³•çš„æ´»åŠ¨ã€‚åŒæ—¶ï¼Œæˆ‘ä»¬ä¹Ÿè¦æ±‚ä½¿ç”¨è€…ä¸è¦å°†TeleSpeechæ¨¡å‹ç”¨äºæ²¡æœ‰å®‰å…¨å®¡æŸ¥å’Œå¤‡æ¡ˆçš„äº’è”ç½‘æœåŠ¡ã€‚æˆ‘ä»¬å¸Œæœ›æ‰€æœ‰ä½¿ç”¨è€…éµå®ˆä¸Šè¿°åŸåˆ™ï¼Œç¡®ä¿ç§‘æŠ€å‘å±•åœ¨åˆæ³•åˆè§„çš„ç¯å¢ƒä¸‹è¿›è¡Œã€‚

æˆ‘ä»¬å·²ç»å°½æˆ‘ä»¬æ‰€èƒ½ï¼Œæ¥ç¡®ä¿æ¨¡å‹è®­ç»ƒè¿‡ç¨‹ä¸­ä½¿ç”¨çš„æ•°æ®çš„åˆè§„æ€§ã€‚ç„¶è€Œï¼Œå°½ç®¡æˆ‘ä»¬å·²ç»åšå‡ºäº†å·¨å¤§çš„åŠªåŠ›ï¼Œä½†ç”±äºæ¨¡å‹å’Œæ•°æ®çš„å¤æ‚æ€§ï¼Œä»æœ‰å¯èƒ½å­˜åœ¨ä¸€äº›æ— æ³•é¢„è§çš„é—®é¢˜ã€‚å› æ­¤ï¼Œå¦‚æœç”±äºä½¿ç”¨TeleSpeechå¼€æºæ¨¡å‹è€Œå¯¼è‡´çš„ä»»ä½•é—®é¢˜ï¼ŒåŒ…æ‹¬ä½†ä¸é™äºæ•°æ®å®‰å…¨é—®é¢˜ã€å…¬å…±èˆ†è®ºé£é™©ï¼Œæˆ–æ¨¡å‹è¢«è¯¯å¯¼ã€æ»¥ç”¨ã€ä¼ æ’­æˆ–ä¸å½“åˆ©ç”¨æ‰€å¸¦æ¥çš„ä»»ä½•é£é™©å’Œé—®é¢˜ï¼Œæˆ‘ä»¬å°†ä¸æ‰¿æ‹…ä»»ä½•è´£ä»»ã€‚

## åè®®
ç¤¾åŒºä½¿ç”¨TeleSpeechæ¨¡å‹éœ€è¦éµå¾ªã€Š[TeleSpeechæ¨¡å‹ç¤¾åŒºè®¸å¯åè®®](./TeleSpeechæ¨¡å‹ç¤¾åŒºè®¸å¯åè®®.pdf)ã€‹ã€‚TeleSpeechæ¨¡å‹æ”¯æŒå•†ä¸šç”¨é€”ï¼Œå¦‚æœæ‚¨è®¡åˆ’å°†TeleSpeechæ¨¡å‹æˆ–å…¶è¡ç”Ÿå“ç”¨äºå•†ä¸šç›®çš„ï¼Œæ‚¨éœ€è¦é€šè¿‡ä»¥ä¸‹è”ç³»é‚®ç®± tele_ai@chinatelecom.cnï¼Œæäº¤ã€ŠTeleSpeechæ¨¡å‹ç¤¾åŒºè®¸å¯åè®®ã€‹è¦æ±‚çš„ç”³è¯·ææ–™ã€‚å®¡æ ¸é€šè¿‡åï¼Œå°†ç‰¹æ­¤æˆäºˆæ‚¨ä¸€ä¸ªéæ’ä»–æ€§ã€å…¨çƒæ€§ã€ä¸å¯è½¬è®©ã€ä¸å¯å†è®¸å¯ã€å¯æ’¤é”€çš„å•†ç”¨ç‰ˆæƒè®¸å¯ã€‚

---